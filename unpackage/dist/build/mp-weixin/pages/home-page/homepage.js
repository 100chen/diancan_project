(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/home-page/homepage"],{"43c5":function(t,e,n){"use strict";(function(t){var e=n("4ea4");n("0493");e(n("66fd"));var i=e(n("c425"));wx.__webpack_require_UNI_MP_PLUGIN__=n,t(i.default)}).call(this,n("543d")["createPage"])},"8f0e":function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){}));var i=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){e.stopPropagation(),0!=t.total_quantity&&t.placean_order()})},o=[]},a0f7:function(t,e,n){"use strict";n.r(e);var i=n("d37b"),o=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e["default"]=o.a},a78e:function(t,e,n){},b627:function(t,e,n){"use strict";var i=n("a78e"),o=n.n(i);o.a},c425:function(t,e,n){"use strict";n.r(e);var i=n("8f0e"),o=n("a0f7");for(var a in o)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(a);n("b627");var s=n("f0c5"),r=Object(s["a"])(o["default"],i["b"],i["c"],!1,null,"1dcbc43e",null,!1,i["a"],void 0);e["default"]=r.exports},d37b:function(t,e,n){"use strict";var i=n("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i(n("2eee")),a=i(n("c973")),s=n("f0d1"),r=n("fffa"),c=getApp(),u=c.globalData.Modelmes,d=wx.cloud.database(),h=d.command,l=d.collection("order_data"),f=d.collection("dishes-data"),p={components:{Scart:function(){n.e("pages/home-page/components/s-cart").then(function(){return resolve(n("d37a"))}.bind(null,n)).catch(n.oe)},Details:function(){n.e("pages/home-page/components/goods_detail").then(function(){return resolve(n("6073"))}.bind(null,n)).catch(n.oe)},Home:function(){n.e("pages/skeleton-view/home").then(function(){return resolve(n("af93"))}.bind(null,n)).catch(n.oe)}},data:function(){return{exist:!0,Modelmes:u,itemize:[],trigger:0,goods:[],heightset:[],tophei:0,scroll_into:"",cart:!1,shopping_card:[],popupitem:!1,pro_details:{},tmplIds:"qip2S5bL2P_Af7nflfmUJGelyouRdyq6eL_iWW4xnu8",number_people:0}},methods:{itemIze:function(t,e){var n=this;this.trigger=t,this.scroll_into=e,setTimeout((function(){n.scroll_into=""}),200)},scroLl:function(t){var e=t.detail.scrollTop;e>=this.tophei?e>=this.heightset[this.trigger]&&this.trigger++:e<=this.heightset[this.trigger-1]&&this.trigger--,this.tophei=e},plus:function(t,e,n,i){var o=i.quantity,a=i.image,s=i.name,r=i.unitprice,c=i.unit,u=i._id,d=o+1;this.$set(this.goods[t].good_query[e],"quantity",d);var h={image:a,name:s,unitprice:r,quantity:d,unit:c,total_price:r*d,cid:n,goodsindex:e,_id:u};this.shopping_cart(h)},reduce:function(t,e,n,i){var o=i.quantity,a=i.image,s=i.name,r=i.unitprice,c=i.unit,u=i._id,d=o-1;this.$set(this.goods[t].good_query[e],"quantity",d);var h={image:a,name:s,unitprice:r,quantity:d,unit:c,total_price:r*d,cid:n,goodsindex:e,_id:u};this.shopping_cart(h)},shopping_cart:function(t){if(0==this.shopping_card.length)this.shopping_card.push(t);else{var e=this.shopping_card.findIndex((function(e){return e._id==t._id}));-1==e?this.shopping_card.unshift(t):(this.$set(this.shopping_card[e],"quantity",t.quantity),this.$set(this.shopping_card[e],"total_price",t.total_price))}this.quninit_of_goods()},quninit_of_goods:function(){var t=this,e=this.shopping_card,n={};e.forEach((function(t){n[t.cid]?n[t.cid]+=t.quantity:n[t.cid]=t.quantity}));var i=[];for(var o in n)i.push({cid:o,value:n[o]});i.forEach((function(e){var n=t.itemize.findIndex((function(t){return t.cid==e.cid}));t.$set(t.itemize[n],"sele_quantity",e.value)}))},shopping_Cart_add_sub:function(t,e,n,i,o,a){this.$set(this.shopping_card[t],"quantity",e),this.$set(this.shopping_card[t],"total_price",e*a);var s=this.goods.findIndex((function(t){return t.cid==n}));this.$set(this.goods[s].good_query[o],"quantity",e),this.quninit_of_goods()},empty_data:function(){this.shopping_card=[],this.itemize.forEach((function(t){t.sele_quantity=0})),this.goods.forEach((function(t){t.good_query.forEach((function(t){t.quantity=0}))})),this.dian_shopping(!1)},pop_upitem:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;this.popupitem=t,this.pro_details={index:e,goods_index:n,cid:i,itemgoods:o},console.log("241",this.pro_details)},dian_shopping:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.cart=t},dishEs:function(){var t=this;return(0,a.default)(o.default.mark((function e(){var n;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,wx.cloud.callFunction({name:"Dish-manage",data:{}});case 2:n=e.sent,console.log(n),t.itemize=n.result.res_cate,t.goods=n.result.res_dis,t.scroll_into="a1676441014443",t.$nextTick((function(){t.goods_height()}));case 8:case"end":return e.stop()}}),e)})))()},goods_height:function(){var t=this;this.heightset=[];var e=0,n=wx.createSelectorQuery();n.selectAll(".rig-height").boundingClientRect(),n.exec((function(n){n[0].forEach((function(n){e+=n.height,t.heightset.push(e)})),t.exist=!1}))},placean_order:function(){var t=this;wx.requestSubscribeMessage({tmplIds:[this.tmplIds],success:function(e){console.log("298",e),t.sub_database()},fail:function(e){t.sub_database()}})},sub_database:function(){var t=this;return(0,a.default)(o.default.mark((function e(){var n,i,c,u,d,p,_,g,m;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return wx.showLoading({title:"正在下单",mask:!0}),n=t.shopping_card.filter((function(t){return 0!=t.total_price})),i=0,n.forEach((function(t){i+=t.total_price})),c=wx.getStorageSync("table_num"),u=wx.getStorageSync("number_of_diners"),d={table_number:c,number_of_diners:u,order_time:t.$Time().utcOffset(8).format("YYYY-MM-DD HH:mm:ss"),sett_amount:i,order_no:(0,s.Code)(),transac_status:"unsettled",order_receiving:"mis_orders",menu:[{backup_data:"备用字段",goods_list:n}]},p={backup_data:"备用字段",goods_list:n},e.prev=8,e.next=11,l.where({table_number:c,transac_status:"unsettled"}).field({_id:!0,sett_amount:!0}).get();case 11:if(_=e.sent,0!=_.data.length){e.next=17;break}return e.next=15,l.add({data:d});case 15:e.next=20;break;case 17:return g=Number(_.data[0].sett_amount)+i,e.next=20,l.doc(_.data[0]._id).update({data:{sett_amount:g,order_receiving:"mis_orders",menu:h.unshift(p)}});case 20:return n.forEach(function(){var t=(0,a.default)(o.default.mark((function t(e){return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,f.doc(e._id).update({data:{monthlysale:h.inc(e.quantity)}});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),m=t.$Time().utcOffset(8).format("YYYY-MM-DD"),e.next=24,(new r.Analysis).sameday(m,i);case 24:t.push_message(),wx.redirectTo({url:"/pages/order-detail/detail"}),wx.hideLoading(),e.next=32;break;case 29:e.prev=29,e.t0=e["catch"](8),wx.showToast({title:"发送错误",icon:"error"});case 32:case"end":return e.stop()}}),e,null,[[8,29]])})))()},my_order:function(){wx.navigateTo({url:"/pages/my-order/my-order"})},push_message:function(){var t=this.goeasy.pubsub;t.publish({channel:"my_channel",message:"Hello 我是小程序端来的!",onSuccess:function(){console.log("消息发布成功。")},onFailed:function(t){console.log("消息发送失败，错误编码："+t.code+" 错误信息："+t.content)}})}},onLoad:function(t){this.number_people=wx.getStorageSync("number_of_diners"),this.dishEs()},computed:{total_quantity:function(){var t=0;return this.shopping_card.forEach((function(e){t+=e.quantity})),t}}};e.default=p}},[["43c5","common/runtime","common/vendor"]]]);